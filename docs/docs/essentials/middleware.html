<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Middleware | Milkio Docs</title>
    <meta name="description" content="A human-centered Bun framework, developing APIs is now easy enough!">
    <meta name="generator" content="VitePress v1.0.1">
    <link rel="preload stylesheet" href="/milkio/assets/style.GR-lnwpN.css" as="style">
    
    <script type="module" src="/milkio/assets/app.BaRIK2wd.js"></script>
    <link rel="preload" href="/milkio/assets/inter-roman-latin.Bu8hRsVA.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/milkio/assets/chunks/framework.B_Y9JRDA.js">
    <link rel="modulepreload" href="/milkio/assets/chunks/theme.kr4yAtXS.js">
    <link rel="modulepreload" href="/milkio/assets/docs_essentials_middleware.md.D0CCQKe_.lean.js">
    <script>(function(e,i,t,r,m,n,s){e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},n=i.createElement(r),n.async=1,n.src="https://www.clarity.ms/tag/"+m,s=i.getElementsByTagName(r)[0],s.parentNode.insertBefore(n,s)})(window,document,"clarity","script","lpkggmj4ib");</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-d8b57b2d><!--[--><!--]--><!--[--><span tabindex="-1" data-v-c8291ffa></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-c8291ffa> Skip to content </a><!--]--><!----><header class="VPNav" data-v-d8b57b2d data-v-7ad780c2><div class="VPNavBar has-sidebar top" data-v-7ad780c2 data-v-844edcde><div class="wrapper" data-v-844edcde><div class="container" data-v-844edcde><div class="title" data-v-844edcde><div class="VPNavBarTitle has-sidebar" data-v-844edcde data-v-0ad69264><a class="title" href="/milkio/" data-v-0ad69264><!--[--><!--]--><!----><span data-v-0ad69264>Milkio Docs</span><!--[--><!--]--></a></div></div><div class="content" data-v-844edcde><div class="content-body" data-v-844edcde><!--[--><!--]--><div class="VPNavBarSearch search" data-v-844edcde><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-844edcde data-v-f732b5d0><span id="main-nav-aria-label" class="visually-hidden" data-v-f732b5d0>Main Navigation</span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/milkio/SUPPORT.html" tabindex="0" data-v-f732b5d0 data-v-08fbf4b6><!--[--><span data-v-08fbf4b6>
          <span class="lang-en">Sponsors</span>
          <span class="lang-zh">支持者们</span>
        </span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-844edcde data-v-283b26e9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-283b26e9 data-v-7df97737 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-7df97737></span><span class="vpi-moon moon" data-v-7df97737></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-844edcde data-v-ef6192dc data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/southern-aurora/milkio" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-844edcde data-v-8e87c032 data-v-af5898d3><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-af5898d3><span class="vpi-more-horizontal icon" data-v-af5898d3></span></button><div class="menu" data-v-af5898d3><div class="VPMenu" data-v-af5898d3 data-v-e42ed9b3><!----><!--[--><!--[--><!----><div class="group" data-v-8e87c032><div class="item appearance" data-v-8e87c032><p class="label" data-v-8e87c032>Appearance</p><div class="appearance-action" data-v-8e87c032><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title="Switch to dark theme" aria-checked="false" data-v-8e87c032 data-v-7df97737 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-7df97737></span><span class="vpi-moon moon" data-v-7df97737></span><!--]--></span></span></button></div></div></div><div class="group" data-v-8e87c032><div class="item social-links" data-v-8e87c032><div class="VPSocialLinks social-links-list" data-v-8e87c032 data-v-e71e869c><!--[--><a class="VPSocialLink no-icon" href="https://github.com/southern-aurora/milkio" aria-label="github" target="_blank" rel="noopener" data-v-e71e869c data-v-358b6670><span class="vpi-social-github" /></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-844edcde data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-844edcde><div class="divider-line" data-v-844edcde></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-d8b57b2d data-v-2488c25a><div class="container" data-v-2488c25a><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-2488c25a><span class="vpi-align-left menu-icon" data-v-2488c25a></span><span class="menu-text" data-v-2488c25a>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-2488c25a data-v-0b5c97a1><button data-v-0b5c97a1>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-d8b57b2d data-v-4871f9f5><div class="curtain" data-v-4871f9f5></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-4871f9f5><span class="visually-hidden" id="sidebar-aria-label" data-v-4871f9f5> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><!----><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
          <span class="lang-en">Introduction</span>
          <span class="lang-zh">简介</span>
        </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/quick-start.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
          <span class="lang-en">Quick Start</span>
          <span class="lang-zh">快速开始</span>
        </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/generation-phase.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
          <span class="lang-en">GenerationPhase</span>
          <span class="lang-zh">生成阶段</span>
        </p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0 has-active" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>
          <span class="lang-en">Essentials</span>
          <span class="lang-zh">基础功能</span>
        </h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/api.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">API</span>
              <span class="lang-zh">API 接口</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/api-test.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">APITest</span>
              <span class="lang-zh">APITest 接口测试</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/router.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Router</span>
              <span class="lang-zh">Router 路由</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/header.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Header</span>
              <span class="lang-zh">Header 头部</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/fail-handling.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">FailureHandling</span>
              <span class="lang-zh">FailureHandling 失败处理</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/use.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Use</span>
              <span class="lang-zh">Use 使用</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/bootstrap.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Bootstrap</span>
              <span class="lang-zh">Bootstrap 启动项</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/middleware.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Middleware</span>
              <span class="lang-zh">Middleware 中间件</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/meta.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Meta</span>
              <span class="lang-zh">Meta 元数据</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/config.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Config</span>
              <span class="lang-zh">Config 配置</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/essentials/logger.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Logger</span>
              <span class="lang-zh">Logger 日志</span>
            </p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>
          <span class="lang-en">Client</span>
          <span class="lang-zh">客户端</span>
        </h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/client/get-started.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
            <span class="lang-en">GetStarted</span>
            <span class="lang-zh">起步</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/client/middleware.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Middleware</span>
              <span class="lang-zh">Middleware 中间件</span>
            </p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/client/publish-client.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">PublishClient</span>
              <span class="lang-zh">发布客户端</span>
            </p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>Cookbook</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/cookbook/get-started.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
            <span class="lang-en">GetStarted</span>
            <span class="lang-zh">起步</span>
            </p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>
          <span class="lang-en">Extensions</span>
          <span class="lang-zh">扩展</span>
        </h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/extensions/drizzle.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Drizzle</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/extensions/redis.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>Redis</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/extensions/tson.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">TSON</span>
              <span class="lang-zh">TSON</span>
            </p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>VSCodeExtension</h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/docs/quick-start.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
            <span class="lang-en">Template</span>
            <span class="lang-zh">Template 模板</span>
            </p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="group" data-v-4871f9f5><section class="VPSidebarItem level-0" data-v-4871f9f5 data-v-c24f735a><div class="item" role="button" tabindex="0" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><h2 class="text" data-v-c24f735a>
          <span class="lang-en">Document</span>
          <span class="lang-zh">文档</span>
        </h2><!----></div><div class="items" data-v-c24f735a><!--[--><div class="VPSidebarItem level-1 is-link" data-v-c24f735a data-v-c24f735a><div class="item" data-v-c24f735a><div class="indicator" data-v-c24f735a></div><a class="VPLink link link" href="/milkio/README.html" data-v-c24f735a><!--[--><p class="text" data-v-c24f735a>
              <span class="lang-en">Contribution</span>
              <span class="lang-zh">贡献</span>
            </p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-d8b57b2d data-v-9a6c75ad><div class="VPDoc has-sidebar" data-v-9a6c75ad data-v-e6f2a212><!--[--><!--]--><div class="container" data-v-e6f2a212><!----><div class="content" data-v-e6f2a212><div class="content-container" data-v-e6f2a212><!--[--><!--[--><!--[--><div class="doc-before-container"><!----></div><!--]--><!--]--><!--]--><main class="main" data-v-e6f2a212><div style="position:relative;" class="vp-doc _milkio_docs_essentials_middleware" data-v-e6f2a212><div><div class="enable-i18n"><!--[--><h1 id="middleware" tabindex="-1">Middleware <a class="header-anchor" href="#middleware" aria-label="Permalink to &quot;Middleware&quot;">​</a></h1><h1 id="middleware-1" tabindex="-1">Middleware <a class="header-anchor" href="#middleware-1" aria-label="Permalink to &quot;Middleware&quot;">​</a></h1><p>中间件是一种全局的、在执行 API 之前或之后，执行任意逻辑的方式。通常，用于配合 <a href="/milkio/docs/essentials/meta.html">Meta</a> 来检查和过滤发送给 API 的请求和响应，或用于设置 <a href="/milkio/docs/essentials/api.html#context">Context</a>。</p><p>Middleware is a global way to execute arbitrary logic before or after executing an API. It is typically used in conjunction with <a href="/milkio/docs/essentials/meta.html">Meta</a> to inspect and filter requests and responses sent to the API, or to set up <a href="/milkio/docs/essentials/api.html#context">Context</a>.</p><p>一开始，你希望一个 API 只对登录之后的用户提供服务，所以，你在 API 的起始位置编写了判断用户是否登录的代码：</p><p>At the beginning, you wanted an API to only provide services to logged-in users, so you wrote code at the starting point of the API to check if the user is logged in.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  meta: {},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;xxxx-xxxx-xxxx-xxxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEVICE_NOT_LOGIN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;这个设备上还没有登录&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 你的后续代码..</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> api</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineApi</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  meta: {},</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  async</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> action</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">params</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;xxxx-xxxx-xxxx-xxxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEVICE_NOT_LOGIN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;The device is not logged in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Your subsequent code..</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>接下来，你发现这段确保用户必须登录的逻辑，似乎许多 API 都需要，这个时候，你就可以把它编写为中间件。在你的 <code>/src/middlewares/</code> 目录中，新建一个 <code>ensure-logined-middleware.ts</code>：</p><p>Next, you realize that this logic of ensuring that the user must be logged in is needed by many APIs. In this case, you can write it as middleware. Create a new file <code>ensure-logined-middleware.ts</code> in your <code>/src/middlewares/</code> directory:</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// 文件: /src/middlewares/ensure-logined-middleware.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ensureLoginedMiddleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  beforeExecute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;xxxx-xxxx-xxxx-xxxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEVICE_NOT_LOGIN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;这个设备上还没有登录&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// file: /src/middlewares/ensure-logined-middleware.ts</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ensureLoginedMiddleware</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  beforeExecute</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">context</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> token</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> context.headers.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">get</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Authorization&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">!==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">  &#39;xxxx-xxxx-xxxx-xxxx&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">throw</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> reject</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;DEVICE_NOT_LOGIN&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;This device is not logged in&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>我们使用了 <code>defineMiddleware</code> 定义了一个中间件。在里面，我们使用了一个 <code>beforeExecute</code> 生命周期挂钩，它会在 API 被执行之前调用，在任何生命周期挂钩中，抛出任何异常都可以中断调用。如果挂钩方法都正常执行完成，那么将继续执行下一个挂钩。</p><p>We have used <code>defineMiddleware</code> to define a middleware. Inside it, we have used a <code>beforeExecute</code> lifecycle hook, which is called before the API is executed. In any lifecycle hook, throwing any exception can interrupt the call. If all hook methods are executed successfully, the next hook will be executed.</p><p>我们需要将中间件添加到 MilkioApp 中，编辑你的 <code>/index.ts</code> 文件：</p><p>We need to add middleware to MilkioApp. Please edit your <code>/index.ts</code> file.</p><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> milkio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMilkioApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  middlewares</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 你刚刚编写的中间件..</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ensureLoginedMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><div class="language-ts vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> milkio</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> createMilkioApp</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  middlewares</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // The middleware you just wrote...</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    ensureLoginedMiddleware</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>middlewares 是一个函数，它返回一个数组，其中包含你要添加到 MilkioApp 的中间件。数组中越靠前的中间件，就越接近于&quot;洋葱&quot;的最外部。</p><p>middlewares is a function that returns an array containing the middleware you want to add to MilkioApp. The middleware closer to the beginning of the array is closer to the outer layer of the &quot;onion&quot;.</p><div class="language-md vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">md</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> middlewares: () =&gt; [middlewareA, middlewareB, middlewareC]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">客户端 (请求)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareA -&gt; beforeExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareB -&gt; beforeExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareC -&gt; beforeExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">执行 API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareC -&gt; afterExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareB -&gt; afterExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareA -&gt; afterExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">客户端 (响应)</span></span></code></pre></div><div class="language-md vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">md</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> middlewares: () =&gt; [middlewareA, middlewareB, middlewareC]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Client (Reuqest)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareA -&gt; beforeExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareB -&gt; beforeExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareC -&gt; beforeExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Execute API</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareC -&gt; afterExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareB -&gt; afterExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(middlewareA -&gt; afterExecute)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[ ▼ ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">Client (Response)</span></span></code></pre></div><h2 id="生命周期挂钩" tabindex="-1">生命周期挂钩 <a class="header-anchor" href="#生命周期挂钩" aria-label="Permalink to &quot;生命周期挂钩&quot;">​</a></h2><h2 id="lifecycle-hook" tabindex="-1">Lifecycle Hook <a class="header-anchor" href="#lifecycle-hook" aria-label="Permalink to &quot;Lifecycle Hook&quot;">​</a></h2><table><thead><tr><th>方法名称</th><th>触发时机</th><th>参数</th><th>备注</th></tr></thead><tbody><tr><td>bootstrap</td><td>在 MilkioApp 启动时执行</td><td>milkioApp</td><td>仅在启动时被执行一次</td></tr><tr><td>afterHTTPRequest</td><td>在 HTTP 请求到达之后执行</td><td>headers, detail</td><td>仅对于 HTTP 调用会执行</td></tr><tr><td>beforeExecute</td><td>在 API 被真正执行之前执行</td><td>context</td><td>通过任何方式调用都执行</td></tr><tr><td>afterExecute</td><td>在 API 被真正执行之后执行</td><td>context, response</td><td>通过任何方式调用都执行</td></tr><tr><td>afterHTTPRequest</td><td>在 HTTP 请求结束之前执行</td><td>response, detail</td><td>仅对于 HTTP 调用会执行</td></tr></tbody></table><table><thead><tr><th>Method Name</th><th>Trigger Timing</th><th>Parameters</th><th>Remarks</th></tr></thead><tbody><tr><td>bootstrap</td><td>Executed when MilkioApp starts</td><td>milkioApp</td><td>Only executed once at startup</td></tr><tr><td>afterHTTPRequest</td><td>Executed after an HTTP request arrives</td><td>headers, detail</td><td>Only executed for HTTP calls</td></tr><tr><td>beforeExecute</td><td>Executed before the API is actually executed</td><td>context</td><td>Executed for any type of call</td></tr><tr><td>afterExecute</td><td>Executed after the API is actually executed</td><td>context, response</td><td>Executed for any type of call</td></tr><tr><td>afterHTTPRequest</td><td>Executed before the HTTP request ends</td><td>response, detail</td><td>Only executed for HTTP calls</td></tr></tbody></table><!--]--></div></div></div></main><footer class="VPDocFooter" data-v-e6f2a212 data-v-b77f9094><!--[--><!--]--><!----><nav class="prev-next" data-v-b77f9094><div class="pager" data-v-b77f9094><a class="VPLink link pager-link prev" href="/milkio/docs/essentials/bootstrap.html" data-v-b77f9094><!--[--><span class="desc" data-v-b77f9094>Previous page</span><span class="title" data-v-b77f9094>
              <span class="lang-en">Bootstrap</span>
              <span class="lang-zh">Bootstrap 启动项</span>
            </span><!--]--></a></div><div class="pager" data-v-b77f9094><a class="VPLink link pager-link next" href="/milkio/docs/essentials/meta.html" data-v-b77f9094><!--[--><span class="desc" data-v-b77f9094>Next page</span><span class="title" data-v-b77f9094>
              <span class="lang-en">Meta</span>
              <span class="lang-zh">Meta 元数据</span>
            </span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"support.md\":\"DJBQAojz\",\"docs_client_middleware.md\":\"S7xLdJHk\",\"readme.md\":\"so0dFqdw\",\"docs_essentials_header.md\":\"DuIJreVX\",\"docs_essentials_api.md\":\"BkyiYTZy\",\"docs_generation-phase.md\":\"DMeEvVyX\",\"docs_essentials_bootstrap.md\":\"BZCIinXF\",\"docs_client_publish-client.md\":\"snsZkGAw\",\"docs_essentials_fail-handling.md\":\"BYZDt9dZ\",\"docs_client_get-started.md\":\"BOFtFGly\",\"docs_essentials_logger.md\":\"CT8ezQ3D\",\"docs_quick-start.md\":\"D_5xQ2LC\",\"docs_essentials_use.md\":\"BHdJGsht\",\"docs_essentials_router.md\":\"C0MQRPoD\",\"docs_essentials_config.md\":\"BOYByQCQ\",\"docs_extensions_drizzle.md\":\"CFv2akWM\",\"docs_essentials_api-test.md\":\"BFOrPVtv\",\"docs_essentials_meta.md\":\"_GsNtvn3\",\"docs_cookbook_get-started.md\":\"DIl1U9qj\",\"index.md\":\"DrbH8vgN\",\"docs_essentials_middleware.md\":\"D0CCQKe_\",\"docs_extensions_tson.md\":\"D2SOwJuJ\",\"docs_extensions_redis.md\":\"CtmigJTJ\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Milkio Docs\",\"description\":\"A human-centered Bun framework, developing APIs is now easy enough!\",\"base\":\"/milkio/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/southern-aurora/milkio\"}],\"nav\":[{\"text\":\"\\n          <span class=\\\"lang-en\\\">Sponsors</span>\\n          <span class=\\\"lang-zh\\\">支持者们</span>\\n        \",\"link\":\"/SUPPORT\"}],\"sidebar\":[{\"text\":\"\\n          <span class=\\\"lang-en\\\">Introduction</span>\\n          <span class=\\\"lang-zh\\\">简介</span>\\n        \",\"link\":\"/\"},{\"text\":\"\\n          <span class=\\\"lang-en\\\">Quick Start</span>\\n          <span class=\\\"lang-zh\\\">快速开始</span>\\n        \",\"link\":\"/docs/quick-start\"},{\"text\":\"\\n          <span class=\\\"lang-en\\\">GenerationPhase</span>\\n          <span class=\\\"lang-zh\\\">生成阶段</span>\\n        \",\"link\":\"/docs/generation-phase\"},{\"text\":\"\\n          <span class=\\\"lang-en\\\">Essentials</span>\\n          <span class=\\\"lang-zh\\\">基础功能</span>\\n        \",\"items\":[{\"text\":\"\\n              <span class=\\\"lang-en\\\">API</span>\\n              <span class=\\\"lang-zh\\\">API 接口</span>\\n            \",\"link\":\"/docs/essentials/api\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">APITest</span>\\n              <span class=\\\"lang-zh\\\">APITest 接口测试</span>\\n            \",\"link\":\"/docs/essentials/api-test\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Router</span>\\n              <span class=\\\"lang-zh\\\">Router 路由</span>\\n            \",\"link\":\"/docs/essentials/router\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Header</span>\\n              <span class=\\\"lang-zh\\\">Header 头部</span>\\n            \",\"link\":\"/docs/essentials/header\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">FailureHandling</span>\\n              <span class=\\\"lang-zh\\\">FailureHandling 失败处理</span>\\n            \",\"link\":\"/docs/essentials/fail-handling\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Use</span>\\n              <span class=\\\"lang-zh\\\">Use 使用</span>\\n            \",\"link\":\"/docs/essentials/use\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Bootstrap</span>\\n              <span class=\\\"lang-zh\\\">Bootstrap 启动项</span>\\n            \",\"link\":\"/docs/essentials/bootstrap\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Middleware</span>\\n              <span class=\\\"lang-zh\\\">Middleware 中间件</span>\\n            \",\"link\":\"/docs/essentials/middleware\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Meta</span>\\n              <span class=\\\"lang-zh\\\">Meta 元数据</span>\\n            \",\"link\":\"/docs/essentials/meta\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Config</span>\\n              <span class=\\\"lang-zh\\\">Config 配置</span>\\n            \",\"link\":\"/docs/essentials/config\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Logger</span>\\n              <span class=\\\"lang-zh\\\">Logger 日志</span>\\n            \",\"link\":\"/docs/essentials/logger\"}]},{\"text\":\"\\n          <span class=\\\"lang-en\\\">Client</span>\\n          <span class=\\\"lang-zh\\\">客户端</span>\\n        \",\"items\":[{\"text\":\"\\n            <span class=\\\"lang-en\\\">GetStarted</span>\\n            <span class=\\\"lang-zh\\\">起步</span>\\n            \",\"link\":\"/docs/client/get-started\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">Middleware</span>\\n              <span class=\\\"lang-zh\\\">Middleware 中间件</span>\\n            \",\"link\":\"/docs/client/middleware\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">PublishClient</span>\\n              <span class=\\\"lang-zh\\\">发布客户端</span>\\n            \",\"link\":\"/docs/client/publish-client\"}]},{\"text\":\"Cookbook\",\"items\":[{\"text\":\"\\n            <span class=\\\"lang-en\\\">GetStarted</span>\\n            <span class=\\\"lang-zh\\\">起步</span>\\n            \",\"link\":\"/docs/cookbook/get-started\"}]},{\"text\":\"\\n          <span class=\\\"lang-en\\\">Extensions</span>\\n          <span class=\\\"lang-zh\\\">扩展</span>\\n        \",\"items\":[{\"text\":\"Drizzle\",\"link\":\"/docs/extensions/drizzle\"},{\"text\":\"Redis\",\"link\":\"/docs/extensions/redis\"},{\"text\":\"\\n              <span class=\\\"lang-en\\\">TSON</span>\\n              <span class=\\\"lang-zh\\\">TSON</span>\\n            \",\"link\":\"/docs/extensions/tson\"}]},{\"text\":\"VSCodeExtension\",\"items\":[{\"text\":\"\\n            <span class=\\\"lang-en\\\">Template</span>\\n            <span class=\\\"lang-zh\\\">Template 模板</span>\\n            \",\"link\":\"/docs/quick-start.md\"}]},{\"text\":\"\\n          <span class=\\\"lang-en\\\">Document</span>\\n          <span class=\\\"lang-zh\\\">文档</span>\\n        \",\"items\":[{\"text\":\"\\n              <span class=\\\"lang-en\\\">Contribution</span>\\n              <span class=\\\"lang-zh\\\">贡献</span>\\n            \",\"link\":\"/README\"}]}],\"aside\":false,\"search\":{\"provider\":\"local\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>